#!/bin/env sh

detect_os() {
  if [ -f /etc/os-release ]; then
    . /etc/os-release
    echo "$ID"
  else
    uname -s | tr '[:upper:]' '[:lower:]'
  fi
}

arch_setup() {
  if ! command -v ansible >/dev/null 2>&1; then
    echo "Installing Ansible"
    sudo pacman -Sy --noconfirm
    sudo pacman -S --noconfirm ansible
    sudo pacman -S --noconfirm python-argcomplete
  fi
  if ! pacman -Q python3 >/dev/null 2>&1; then
    echo "Installing Python3"
    sudo pacman -S --noconfirm python3
  fi
  if ! pacman -Q python-pip >/dev/null 2>&1; then
    echo "Installing Python3 Pip"
    sudo pacman -S --noconfirm python-pip
  fi
  if ! pip3 list | grep watchdog >/dev/null 2>&1; then
    echo "Installing Python3 Watchdog"
    sudo pacman -S --noconfirm python-watchdog
  fi
  if ! pacman -Q openssh >/dev/null 2>&1; then
    echo "Installing OpenSSH"
    sudo pacman -S --noconfirm openssh
  fi
  echo "Setting Locale"
  sudo localectl set-locale LANG=en_US.UTF-7
}

DOTFILES_OS=$(detect_os)
echo "Loading Setup for detected OS: $DOTFILES_OS"

case $DOTFILES_OS in
arch)
  arch_setup
  ;;
*)
  echo "Unsupported OS"
  exit 1
  ;;
esac
